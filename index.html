<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>問い合わせ状況検索</title>
<style>
  body { font-family: "Noto Sans JP", sans-serif; margin: 30px; background: #fdfdfd; }
  h1 { font-size: 1.8em; margin-bottom: 20px; }
  label { display: inline-block; width: 130px; font-weight: bold; }
  select, input { padding: 8px; margin: 5px 0; width: 200px; }
  button { background: #2b8a3e; color: white; padding: 8px 20px; border: none; border-radius: 5px; cursor: pointer; }
  button:hover { background: #256f34; }

  table { width: 100%; border-collapse: collapse; margin-top: 25px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
  th { background: #f4f4f4; }

  /* 状態別スタイル */
  .cell-gray { background: #f0f0f0; color: #777; }
  .cell-normal { background: white; color: #333; }
  .cell-resolved { background: #e6ffe6; font-weight: bold; }

  .error { color: red; margin-top: 10px; }
</style>
</head>
<body>
<h1>問い合わせ状況検索</h1>

<label>対象年月（必須）:</label>
<select id="month"></select><br>
<label>受注番号:</label><input id="orderNo" type="text"><br>
<label>挙式日:</label><input id="wedding" type="text" placeholder="例）9月12日"><br>
<label>新郎姓:</label><input id="groom" type="text" placeholder="例）山田"><br>
<label>新婦姓:</label><input id="bride" type="text" placeholder="例）佐藤"><br>

<button onclick="search()">検索</button>
<p id="error" class="error"></p>

<table>
  <thead>
    <tr>
      <th>受注番号</th><th>挙式日</th><th>新郎</th><th>新婦</th><th>バックカラー</th><th>ネームプレート</th>
    </tr>
  </thead>
  <tbody id="result-body"></tbody>
</table>

<script>
async function loadMonths() {
  const res = await fetch("https://ko-umeda-coder.github.io/check-bc-np/months.json?" + Date.now());
  const months = await res.json();
  const select = document.getElementById("month");
  select.innerHTML = '<option value="">-- 選択してください --</option>';
  months.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m; opt.textContent = m;
    select.appendChild(opt);
  });
}

async function search() {
  const month = document.getElementById("month").value;
  const orderNo = document.getElementById("orderNo").value.trim();
  const groom = document.getElementById("groom").value.trim();
  const bride = document.getElementById("bride").value.trim();
  const error = document.getElementById("error");
  error.textContent = "";

  if (!month) { error.textContent = "対象年月を選択してください。"; return; }

  const url = `https://ko-umeda-coder.github.io/check-bc-np/${month}.json?${Date.now()}`;
  const res = await fetch(url);
  const data = await res.json();

  const results = data.filter(r =>
    (!orderNo || r["受注番号"].includes(orderNo)) &&
    (!groom || r["新郎"].includes(groom)) &&
    (!bride || r["新婦"].includes(bride))
  );
  renderResults(results);
}

function renderResults(results) {
  const tbody = document.getElementById("result-body");
  tbody.innerHTML = "";
  if (results.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6">該当データがありません。</td></tr>';
    return;
  }

  results.forEach(r => {
    const tr = document.createElement("tr");
    ["受注番号", "挙式日", "新郎", "新婦", "BK", "ネームプレート"].forEach(key => {
      const td = document.createElement("td");
      const val = r[key] || "";

      if (val === "対象外") td.classList.add("cell-gray");
      else if (val.includes("問い合わせ中")) td.classList.add("cell-normal");
      else td.classList.add("cell-resolved");

      td.textContent = val;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

loadMonths();
</script>
</body>
</html>
