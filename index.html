<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>問い合わせ状況検索</title>
<style>
  body {
    font-family: "Segoe UI", "Hiragino Sans", sans-serif;
    margin: 20px;
  }

  h1 {
    font-size: 22px;
    margin-bottom: 16px;
    border-left: 6px solid #006400;
    padding-left: 10px;
  }

  /* 検索フォーム */
  .search-form {
    margin-bottom: 20px;
    background: #f9f9f9;
    padding: 16px;
    border-radius: 8px;
    max-width: 600px;
  }

  label {
    display: inline-block;
    width: 120px;
    font-weight: bold;
    margin-bottom: 6px;
  }

  select, input[type="text"] {
    width: 300px;
    height: 32px;
    font-size: 15px;
    padding: 4px 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: #fff;
  }

  input[type="text"]::placeholder {
    color: #999;
  }

  button {
    background-color: #006400;
    color: #fff;
    border: none;
    border-radius: 4px;
    padding: 8px 18px;
    font-size: 15px;
    cursor: pointer;
    margin-top: 10px;
  }

  button:hover {
    background-color: #228B22;
  }

  /* テーブル */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 15px;
  }

  th, td {
    border: 1px solid #ccc;
    text-align: center;
    padding: 8px;
  }

  th {
    background: #f2f2f2;
  }

  /* 特殊な背景と文字装飾 */
  .gray-cell {
    background-color: #e0e0e0;
  }

  .green-cell {
    background-color: #e8fbe8;
    font-weight: bold;
  }

  /* ページネーション */
  .pagination {
    margin-top: 10px;
    text-align: center;
  }

  .pagination button {
    background: #ddd;
    margin: 0 4px;
    padding: 5px 10px;
    border-radius: 4px;
  }

  .pagination button.active {
    background: #006400;
    color: #fff;
  }
</style>
</head>
<body>

<h1>問い合わせ状況検索</h1>

<div class="search-form">
  <label>対象年月（必須）：</label>
  <select id="targetMonth"></select><br>

  <label>受注番号：</label>
  <input type="text" id="orderNo"><br>

  <label>挙式日：</label>
  <input type="text" id="weddingDate" placeholder="例）9月12日"><br>

  <label>新郎姓：</label>
  <input type="text" id="groom" placeholder="例）山田"><br>

  <label>新婦姓：</label>
  <input type="text" id="bride" placeholder="例）佐藤"><br>

  <button onclick="searchData()">検索</button>
</div>

<table id="resultTable">
  <thead>
    <tr>
      <th>受注番号</th>
      <th>挙式日</th>
      <th>新郎</th>
      <th>新婦</th>
      <th>バックカラー</th>
      <th>ネームプレート</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination" id="pagination"></div>

<script>
let allData = [];
let currentPage = 1;
const rowsPerPage = 5;

async function searchData() {
  const month = document.getElementById("targetMonth").value;
  const orderNo = document.getElementById("orderNo").value.trim();
  const groom = document.getElementById("groom").value.trim();
  const bride = document.getElementById("bride").value.trim();
  const date = document.getElementById("weddingDate").value.trim();

  const response = await fetch("https://raw.githubusercontent.com/ko-umeda-coder/check-bc-np/main/daigaihana_data.json");
  const json = await response.json();

  allData = json.filter(d =>
    (!month || d["対象年月"] === month) &&
    (!orderNo || (d["受注番号"] || "").includes(orderNo)) &&
    (!groom || (d["新郎"] || "").includes(groom)) &&
    (!bride || (d["新婦"] || "").includes(bride)) &&
    (!date || (d["挙式日"] || "").includes(date))
  );

  currentPage = 1;
  displayData();
}

function displayData() {
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = allData.slice(start, end);

  for (const item of pageData) {
    const backColor = item["バックカラー"] || item["BK"] || "";
    const namePlate = item["ネームプレート"] || item["NP"] || "";

    const tr = document.createElement("tr");

    // セルごとに色をつける
    const tdBack = document.createElement("td");
    tdBack.textContent = backColor;
    if (backColor === "対象外") tdBack.classList.add("gray-cell");
    else if (backColor && backColor !== "問い合わせ中") tdBack.classList.add("green-cell");

    const tdName = document.createElement("td");
    tdName.textContent = namePlate;
    if (namePlate === "対象外") tdName.classList.add("gray-cell");
    else if (namePlate && namePlate !== "問い合わせ中" && namePlate !== "問い合わせ中です。") tdName.classList.add("green-cell");

    tr.innerHTML = `
      <td>${item["受注番号"] || ""}</td>
      <td>${item["挙式日"] || ""}</td>
      <td>${item["新郎"] || ""}</td>
      <td>${item["新婦"] || ""}</td>
    `;
    tr.appendChild(tdBack);
    tr.appendChild(tdName);
    tbody.appendChild(tr);
  }

  renderPagination();
}

function renderPagination() {
  const totalPages = Math.ceil(allData.length / rowsPerPage);
  const container = document.getElementById("pagination");
  container.innerHTML = "";

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    if (i === currentPage) btn.classList.add("active");
    btn.onclick = () => {
      currentPage = i;
      displayData();
    };
    container.appendChild(btn);
  }
}

/* 月リスト */
(function(){
  const select = document.getElementById("targetMonth");
  const months = ["2025年3月","2025年4月","2025年5月","2025年6月","2025年7月","2025年8月","2025年9月","2025年10月","2025年11月"];
  for (const m of months) {
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = m;
    select.appendChild(opt);
  }
})();
</script>

</body>
</html>
